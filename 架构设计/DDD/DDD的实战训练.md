## Q：如何利用DDD重构模块业务?

A:分为自顶向下和自底向上两种策略

 第一种策略是自顶向下。这种策略是先做顶层设计，从最高领域逐级分解为中台，分别建立领域模型，根据业务属性分为通用中台或核心中台。领域建模过程主要基于业务现状，暂时不考虑系统现状。**自顶向下的策略适用于全新的应用系统建设，或旧系统推倒重建的情况。** 

 ![img](https://static001.geekbang.org/resource/image/e6/da/e665d85381a9b2c599555cac6a06deda.jpg) 

 第二种策略是自底向上。这种策略是基于业务和系统现状完成领域建模。首先分别完成系统所在业务域的领域建模；然后对齐业务域，找出具有同类或相似业务功能的领域模型，对比分析领域模型的差异，重组领域对象，重构领域模型。这个过程会沉淀公共和复用的业务能力，会将分散的业务模型整合。**自底向上策略适用于遗留系统业务模型的演进式重构。** 

 ![img](https://static001.geekbang.org/resource/image/fb/70/fb11e6941fc471c734d0b85c25cc5370.jpg) 

 ![img](https://static001.geekbang.org/resource/image/a8/c5/a88e9695c7198a1f88f537564ada0bc5.jpg) 

## Q：如何利用事件风暴确定领域？

 事件风暴是一项团队活动，领域专家与项目团队通过头脑风暴的形式，罗列出领域中所有的领域事件，整合之后形成最终的领域事件集合，然后对每一个事件，标注出导致该事件的命令，再为每一个事件标注出命令发起方的角色。命令可以是用户发起，也可以是第三方系统调用或者定时器触发等，最后对事件进行分类，整理出实体、聚合、聚合根以及限界上下文。 

TIPS：在开始重构前，每个人对该模块都有自己的理解，但是这个理解不一定是统一的，比如终端管理，有人说基于IP，有人说基于识别，有人说基于MAC，最终到底如何管理，这个就是需要确认的。

1. 产品愿景： 产品愿景的主要目的是对产品顶层价值的设计，使产品目标用户、核心价值、差异化竞争点等信息达成一致，避免产品偏离方向。  ![img](https://static001.geekbang.org/resource/image/b8/c4/b85983fa6a8c877e77387fdafe1598c4.jpg) 

2. 业务场景分析： 场景分析是从用户视角出发的，根据业务流程或用户旅程，采用用例和场景分析，探索领域中的典型场景，找出领域事件、实体和命令等领域对象，支撑领域建模。事件风暴参与者要尽可能地遍历所有业务细节，充分发表意见，不要遗漏业务要点。 

    场景分析时会产生很多的命令和领域事件。 

    ![img](https://static001.geekbang.org/resource/image/e2/e4/e2f91189e25bbaa81307d1fea694aee4.jpg) 

3.  领域建模 。 领域建模时，我们会根据场景分析过程中产生的领域对象，比如命令、事件等之间关系，找出产生命令的实体，分析实体之间的依赖关系组成聚合，为聚合划定限界上下文，建立领域模型以及模型之间的依赖。领域模型利用限界上下文向上可以指导微服务设计，通过聚合向下可以指导聚合根、实体和值对象的设计。 

    ![img](https://static001.geekbang.org/resource/image/cf/fd/cf35a9437319169784db9e5aab97b1fd.jpg) 

    ![img](https://static001.geekbang.org/resource/image/d0/e1/d0191d4e4c51ff91dc830bf38c0e7ae1.jpg) 

## Q：DDD的代码结构？

A：参考极客时间GitHub以及Thoughtworkers的源码，注意代码分层即可，没有硬性规定。

其中Thoughtworkers的讲解很有启发性。

 ![img](https://static001.geekbang.org/resource/image/eb/b2/eb626396fcb9f541ec46a799275e04b2.png) 

## Q：微服务的演进策略？

A： 在从单体向微服务演进时，演进策略大体分为两种：绞杀者策略和修缮者策略。 

-  绞杀者策略 ： 绞杀者策略类似建筑拆迁，完成部分新建筑物后，然后拆除部分旧建筑物。 
-  修缮者策略 ： 修缮者策略类似古建筑修复，将存在问题的部分功能重建或者修复后，重新加入到原有的建筑中，保持建筑原貌和功能不变。 

## Q：DDD使用的误区与原则？

A：DDD的常见误区：

-  所有的领域都用 DDD 
-  全部采用 DDD 战术设计方法 ：某些贫领域模型，高性能模型，多查询都不太适合
-  重战术设计而轻战略设计 
-  DDD 只适用于微服务 

微服务的设计原则：

-  要领域驱动设计，而不是数据驱动设计，也不是界面驱动设计。 

-  要边界清晰的微服务，而不是泥球小单体。 

-  要职能清晰的分层，而不是什么都放的大箩筐。 

-  要做自己能 hold 住的微服务，而不是过度拆分的微服务。 

  