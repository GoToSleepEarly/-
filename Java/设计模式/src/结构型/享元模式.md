# 享元模式

## 定义

享元模式（Flyweight Design Pattern） ， 顾名思义就是被共享的单元。享元模式的意图是复用对象，节省内存，前提是享元对象是不可变对象。 

------



## 实现

**核心：将重复不变的对象抽出**，如果在频繁new对象，就要考虑能否优化

当一个系统中存在大量重复对象的时候，如果这些重复的对象是不可变对象，我们就可以利用享元模式将对象设计成享元，在内存中只保留一份实例，供多处代码引用。这样可以减少内存中对象的数量，起到节省内存的目的。实际上，不仅仅相同对象可以设计成享元，对于相似对象，我们也可以将这些对象中相同的部分（字段）提取出来，设计成享元，让这些大量相似对象引用这些享元。 

 它的代码实现非常简单，主要是通过**工厂模式**，**在工厂类中，通过一个 Map 来缓存已经创建过的享元对象**，来达到复用的目的。 

------

##  享元模式 vs 单例、缓存、对象池 

###  享元模式跟单例

 应用享元模式是为了**对象复用，节省内存**，而应用多例模式是为了**限制对象的个数**。 

###  享元模式跟缓存

 在享元模式的实现中，我们通过工厂类来“缓存”已经创建好的对象。这里的“缓存”实际上是“存储”的意思，跟我们平时所说的“数据库缓存”“CPU 缓存”“MemCache 缓存”是两回事。**我们平时所讲的缓存，主要是为了提高访问效率，而非复用。** 

###  享元模式跟对象池 

 池化技术中的“复用”可以理解为“重复使用”，主要目的是**节省时间**（比如从数据库池中取一个连接，不需要重新创建）。在任意时刻，每一个对象、连接、线程，并不会被多处使用，而是**被一个使用者独占**，当使用完成之后，放回到池中，再由其他使用者重复利用。享元模式中的“复用”可以理解为“共享使用”，在整个生命周期中，都是被所**有使用者共享**的，主要目的是**节省空间**。 

### 关于复用的深入探讨

1. 如果创建后不再消除，只是暴露给外界用的复用，此时可以利用享元模式（大数量级的重复对象）
2. 如果是频繁的创建和回收，为了避免创建对象的开销，此时可以利用对象池（一般重量级的才用，原型模式也可）